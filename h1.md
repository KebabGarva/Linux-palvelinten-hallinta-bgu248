# Viisikko

## x)

### Salt-komentojen pyörittäminen paikallisesti

- Artikkeli esittää esimerkkejä salt-komennoista, joita voi antaa paikallisesti tietokoneelle.
-   
  
### Web-sivujen tekeminen Githubilla


### Raportin kirjoittaminen

## a)
![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/465e03f7-a38d-48c9-947b-df161fdfb946)

Minulla oli salt valmiiksi asennettuna Windowsiin. Tähän mennessä olen ymmärtänyt, että voin antaa samoja komentoja powershelliin kuin tekisin tyypillisesti Tein kyseisen toimenpiteen ensimmäisen luennon aikana. Haluan vielä selvittää, voiko saltin asentaa powershellin kautta. Päädyin poistamaan saltin Windowsista.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/f68d8e8c-95e8-4887-9a96-e4eebe2a0a04)

Tämän jälkeen kokeilin pelkästään powershell-komennolla asentaa Saltin Windowsiin. Oikeastaan välittömästi tajusin sen olevan epäkäytännöllistä, koska Windowsilla ei ole samanlaista pakettivarastoa kuin Linuxissa. Löysin nopean googlauksen jälkeen sharepointdiary.com -verkkosivulta Salaudeen Rajackin artikkelin, jossa näytetään eri komentoja verkossa olevien tiedostojen lataukseen. Suoritin alla olevan komennon lataakseni Saltin asennustiedoston Windowsiin. 

`Invoke-WebRequest -Uri "https://repo.saltproject.io/salt/py3/windows/latest/Salt-Minion-3007.0-Py3-AMD64-Setup.exe" -OutFile "C:\Users\sakus\Downloads\saltohjelma.exe" -UseBasicParsing -PassThru`

Yritin aiemmin lisätä toisen komennon perään, joka lisäisi edistymispalkin komentoon. En pystynyt siihen ilman scriptiä, ja ajattelin jättää sen myöhemmälle. Ohjelma valittaa muuttujan puutteesta, ja en tiedä, miten lisätä muuttuja komentoon, joka ei hyödynnä scriptiä. Yritin hyödyntää artikkelin pohjaa. Oletin komennon toimivan, koska artikkelia oli päivitetty noin 2 kuukautta sitten tätä tehtävää tehdessä.

`Invoke-WebRequest -Uri "https://repo.saltproject.io/salt/py3/windows/latest/Salt-Minion-3007.0-Py3-AMD64-Setup.exe" -OutFile "C:/Users/sakus/Downloads/saltohjelma.exe" -UseBasicParsing -PassThru | Write-Progress -Activity "Downloading file" -Status "Progress"`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e27dbc17-bb9a-4a93-a17d-811fa32df229)

Halusin hieman lisää hifistellä, ja käynnistää asennusohjelma Powershellin kautta. 

`& C:/Users/sakus/Downloads/saltohjelma.exe`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e8e881d1-28e1-4e1b-a933-a6a7d6d7b9dc)


Tässä vaiheessa annan installerin käynnistää saltin itse.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/2615f08c-adf7-4af9-a523-1c3a7161decf)

Varmistin vielä, onko Salt asennettu.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b074c447-0358-4579-b450-9d51d5600bc7)

Tästä tehtävästä opin sen, **kuinka hidasta on manuaalisesti suorittaa komentoja ilman scriptejä**. Tulen toivottavasti opettelemaan scripteistä lisää tulevaisuudessa.

## b)

Vagrantin asennuksen voi tarkistaa esimerkiksi seuraavalla komennolla: `vagrant version`
![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/cbb9ef46-8940-49db-8cd8-cd19a87b369d)

## c)

Vagrantilla uuden virtuaalikoneen voi luoda yksinkertaisimmillaan katsomalla ensin Vagrant Cloudista haluttu virtuaalikone, minkä jälkeen hyödynnetään `vagrant init ESIMERKKI/KONE` -komentoa. Törmäsin [FreeCodeCampin artikkeliin](https://www.freecodecamp.org/news/create-and-manage-virtual-machines-with-vagrant/), jossa annettiin muistutus siitä, että pitää luoda oma kansio virtuaalikoneelle. Suoritin komennon kuin `mkdir "VagrantTestiH1" ; cd VagrantTestiH1`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/57173b32-4e5e-472b-b037-2e2cf73ccdb8)

Itse valitsin satunnaisesti [tämän kyseisen virtuaalikoneen](https://app.vagrantup.com/debian/boxes/testing64) käytettäväksi. Voimme tietenkin väitellä siitä, oliko valinta oikeasti täysin sattumaa. Suoritin `vagrant init debian/testing64` -komennon. Ajattelin testauksen vuoksi lähteä pois kyseisestä kansiosta pois `cd ~` -komennolla kokeillakseni, voinko käynnistää vagrant-tiedoston ollesani eri kansiossa kuin itse tiedosto. Heti tajusin `Vagrant global-status` -komennon tehtyäni, että kyseinen toimenpide on vielä mahdoton. Minkään tietokoneen tietoja ei tullut Powershelliin, koska itse tietokonetta ei olla edes ladattu. Se toimisi vasta myöhemmin. Suoritin tylsästi komennon `vagrant up`, jotta voin jatkaa tehtävässä eteenpäin.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/749beee4-9ce4-4b4f-a6bf-037e3defe193)

P.s Kokeilin välittömästi `vagrant halt KONEENID` -komentoa, ja sen jälkeen `vagrant up KONEENID`. Se taisi toimia! `Vagrant up`-komento on samaan aikaan kuin virtuaalikoneen asennus- ja päällekytkemisohjelma.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/82bc2f97-8db0-4916-a0a5-fb7f76983759)

## d)

Muodostan ssh:lla yhteyden virtuaalikoneeseeni komennolla `vagrant ssh 7064575`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/38983468-d9a2-48d8-8e1f-5dd8d55db344)

Hyödyntämällä Tero Karvisen [Salt-komentojen pyörittäminen paikallisesti -artikkelia](https://terokarvinen.com/2021/salt-run-command-locally/) suoritin komentosarjan `sudo apt-get update & sudo apt-get -y install salt-minion && sudo salt-call --version`. Jostain syystä salt-minionin lataaminen ei onnistunut, joten kokeilin `sudo apt-get upgrade`-komentoa, jonka jälkeen kokeilin uudestaan ladata minionin. Se ei toiminut taaskaan, koska kyseistä tiedostoa ei pystynyt löytämään.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e6234297-432e-4eb4-a8d5-b1eb883705da)

Salt-masteriäkään ei löytänyt.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bba77937-b8ee-4311-9d17-58738402af50)

Apache2:n kone löysi, mikä hämmenti minua suuresti. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/1e229e7f-48ec-4f05-8f85-e70e09f295ee)

Mietin tässä vaiheessa, mikä aiheutti ongelman. Yritin ensin katsoa `help`-komennon kautta saatavilla olevia komentoja, minkä jälkeen kokeilin vielä `info`-komentoa. Tämä komento ei ollut saatavilla, vaikka `help`-komento kannusti käyttämään `info`-komentoa. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/df18702e-f0f8-43d8-a44b-c9403f399fe0)


Vasta tässä vaiheessa tajusin ottaa selvää erikseen Googlella, mitkä ovat järjestelmä- ja käyttöjärjestelmäinfokomennot. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/6191daf1-4fde-4ccb-964a-45dda71226c0)

Tuli hieman tyhmä olo jälkeenpäin, koska olin käyttänyt Debianin epävakaata "trixie" -julkaisua, josta ei ole vieläkään julkistettu minkäänlaista mahdollista julkaisuajankohtaa. Ryhdyin heti vaihtamaan virtuaalikonetta, ja olen luonut jo aiemmin kansion sitä varten. Halusin vaihtaa [debian/bullseye64 -versioon](https://app.vagrantup.com/debian/boxes/bullseye64), koska tiesin sen aiemman kokemuksen perusteella olevan vakaa, ja jossa toimii salt. Varmistin ensin vanhan virtuaalikoneen olevan poistettu, ja sen jälkeen pyöritin komennon `vagrant init debian/bullseye64 --force ; vagrant up`. Force-asetus oli ehkä mielestäni turha, mutta sen toteutin ollakseni mielessäni 100% varma, että se toimii.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/818348db-8a3a-4046-a6ef-b9f6cadb23e9)


Nyt palasin takaisin siihen vaiheeseen, jossa minun on alunperin pitänyt olla. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bac193e9-c795-4bfa-b0a0-79d0d2550bac)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/640550d8-0024-4c11-8a92-35088477097c)

Tehtävänanto venyi yllättävän pitkäksi, mutta kokemus oli opettava!

## e) Tilafunktiot

### PKG 

PKG -tilafunktiolla hallinoidaan valmisohjelmistojen toimintaa. Esimerkiksi voimme kokeilla saltilla Apache2:n asentamista. Suoritetaan komento `sudo salt-call --local -l info state.single pkg.installed apache2`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/dce0653f-3526-4d3c-9f52-eb9aa54271c1)

Kävi yksinkertaisesti huono tuuri asentamisen näkökulmasta, koska asennustiedosto linkin takana ei ollut voimassa. Tiedosto on voimassa tätä raporttia kirjoittaessani vasta huomenna.Pyöritin vielä erikseen `which apache2`- ja `whereis apache2` -komennot ollakseni täysin varma Apache2 -palvelun tiedostojen puuttumisesta.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/0f0f6a64-0252-4eb7-84c3-80e992dd335b)

Jostain kumman syystä Apache2 on asennettavissa tyypillisen `sudo apt-get install` -komennon kautta. Tämän jälkeen pohdin, voiko vika johtua yksinkertaisesta väärästä URL-osoitteesta, jota salt käyttää. Lähdin selvittämään syyn suorittamalla `sudo apt policy apache2` -komennon. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/ac8c07f6-d836-4bbc-80c0-24ba2bf6da81)

Komentojen tulosteen perusteella salt pyrkii saamaan kaikista uusimman version, mutta kyseinen versio ei ole vielä voimassa. Debian saa tiedostonsa virallisen julkaisun hakemiston kautta. Saltilla voi hallinnoida ohjelmistoarkistoon liittyviä asioita pkgrepo -tilafunktiolla, johon en perehdy lisää toistaiseksi. Debian 12.5 julkistettiin 10.2.2024 [tässä Debianin julkaisemassa uutisartikkelissa](https://www.debian.org/News/2024/20240210).  [Hakemistoon, josta onnistuu valmisohjelmisto Apache2:n lataaminen](https://ftp.debian.org/debian/dists/bullseye/), tehtiin viimeeksi muokkauksia samana päivämääränä. Tämän tiedon perusteella seuraavana päivänä tätä raporttia tehdessäni tulee Debian-päivityksiä (jee!!).

Valitaan toinen ohjelmisto ladattavaksi. Mikä olisi parempi ohjelmisto lataa Linux-käyttöjärjestelmälle kuin [Cowsay](https://github.com/tnalpgge/rank-amateur-cowsay)? Suoritin komennon `sudo salt-call --local -l info state.single pkg.installed cowsay`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e9632f45-5c34-4e51-aac7-19d8b19ac7a3)

Tämän perusteella olin jo asentanut Cowsayn tälle kyseiselle virtuaalikoneelle. Kirjoitin seuraavaksi komennon `sudo salt-call --local -l info state.single pkg.removed cowsay`. Hyvästi Cowsay :(

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/c8215841-a8bf-40d4-921c-5d2fa2c4b3a7)

Tulosteen perusteella poistaminen onnistui täysin. Haluan silti varmistaa, onko kyseinen ohjelmisto poistettu kokonaan hyödyntämällä `which`- ja `whereis`-komentoja. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b03ff6d7-462d-445b-819e-67fb9c01e332)

### File

File-tilafunktiolla hallinnoidaan tietokoneen tiedostoja ja hakemistoja. Lisään hakemiston kuin "Cowsayn-Hautajaiset-30-03-2024" komennolla `sudo salt-call --local -l info state.single file.directory ~/Cowsayn-Hautajaiset-30-03-2024`. Lisätään vielä tiedostoja, jotka liittyvät hautajaisiin, hakemiston sisälle. Hyödyntämällä `sudo salt-call --local -l info state.single file.managed ~/Cowsayn-Hautajaiset-30-03-2024/TIEDOSTON-ESIMERKKINIMI`-komentoa pohjana.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/1c270fb0-b985-48de-8921-d9f087ea6fa9)


![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/750ef54b-f750-41c5-bd38-0a76bbe6ad58)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/f08dce7e-ec9a-4726-8790-71e3d16b96bb)


![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/015f2da7-d71f-4139-8240-3e79ab8855b6)

Muuten tulosteena näytetään tismalleen samanlaista informaatiota kuin PKG-funktion toteutuessa, mutta merkittävin ero on kommentissa. Kommentti spesifoi, mitä tiedoston sisällä on. Lisätään hautajaislistaan nimiä seuraavalla komennolla. `sudo salt-call --local -l info state.single file.managed ~/Cowsayn-Hautajaiset-30-03-2024/Hautajaisvieraat contents="Saku Laitinen"`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/a54273e9-7939-415d-be50-879accf597dd)

### Service

Service-tilafunktiolla hallinoidaan, jotka ovat käytännössä taustalla olevii automatisoituja prosesseja, kuten esimerkiksi Samban taustaprosesseja. Samba on suosituin Windows-yhteensopivuusohjelma Linux ja Unix järjestelmiin. Otetaan kyseinen palvelu mukaan tähän esimerkkiin. Suoritan komennon `sudo salt-call --local -l info state.single service.running smbd enable=True` ja sen jälkeen `systemctl` tarkastaakseni lopputuloksen



![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bc55bccc-c7aa-469f-a9f4-c1912018d7e2)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/3e7cda6d-5823-4362-997a-1ee018d8dc92)


Palvelu on jo käytössä, mutta voimme kokeilla sen sammuttamista kokonaan komennolla `sudo salt-call --local -l info state.single service.dead smbd enable=False`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/15d785f2-02ee-496e-b83d-f2f971c761c4)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/06c69b48-ec95-4b74-bb38-091be1fcb76d)

Haluaisin ihan huvikseen kokeilla, mitä tapahtuisi seuraavissa tilanteissa: `service.dead smbd enable=True` ja `service.running smbd enable=False`

*running & False*
![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b4e768d6-b2b7-486b-9c4f-a08fc596e65a)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/611f03c4-515a-44e2-998d-f3b860958c7e)

Huomaan


























## f)

## g)







## Lähteet

https://www.sharepointdiary.com/2021/02/download-files-using-powershell.html
https://www.freecodecamp.org/news/create-and-manage-virtual-machines-with-vagrant/
https://terokarvinen.com/2021/salt-run-command-locally/

