# Viisikko _by Saku Laitinen_

## Sis√§llysluettelo

- **[Johdanto](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Johdanto)**
- **[L√§mmittelyteht√§v√§](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#L√§mmittelyteht√§v√§)**
- **[Saltin asentaminen Windowsiin](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Saltin-asentaminen-Windowsiin)**
- **[Vagrantin asennuksen tarkistaminen Windowsissa](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Vagrantin-asennuksen-tarkistaminen-Windowsissa)**
- **[Uuden virtuaalikoneen luominen Vagrantilla hy√∂dynt√§m√§ll√§ valmista virtuaalikonetta Vagrant Cloud -ymp√§rist√∂st√§](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Uuden-virtuaalikoneen-luominen-Vagrantilla-hy√∂dynt√§m√§ll√§-valmista-virtuaalikonetta-Vagrant-Cloud--ymp√§rist√∂st√§)**
- **[Saltin asennus Linuxiin ja ep√§onnistuneen asentamisen kartoittaminen](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Saltin-asennus-Linuxiin-ja-ep√§onnistuneen-asentamisen-kartoittaminen)**
- **[Tilafunktiot](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Tilafunktiot)**__: pkg, file, service, user, cmd__
- **[Idempotenssi ja sen konkreettiset esimerkit](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Idempotenssi-ja-sen-konkreettiset-esimerkit)**
- **[Grains](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/blob/main/h1.md#Grains)**

## Johdanto

### Mit√§?

T√§m√§ raportti on tehty Tero Karvisen toteuttaman kurssin Palvelinten hallinta yhteydess√§. T√§m√§ raportti kertoo l√§pikohtaisesti, mit√§ tein teht√§v√§n h1 eteen. Sis√§llysluettelon linkkej√§ painamalla pystyy navigoimaan suoraan haluttuun kohtaan.

### Miss√§?

Toteutin teht√§viin liittyv√§t komennot fyysisess√§ Windows 11 - ja virtuaalisissa Debian -ymp√§rist√∂iss√§ hy√∂dynt√§m√§ll√§ [Vagrantia](https://developer.hashicorp.com/vagrant). Spesifoin tarkemmin kappaleen alussa, mitk√§ ovat k√§ytett√§v√§n/k√§ytett√§vien k√§ytt√∂j√§rjestelmien tiedot. Kaikki Windowsilla tehdyt komennot on tehty fyysisess√§ ymp√§rist√∂ss√§, ja Linuxilla on tehty virtuaaliymp√§rist√∂ss√§. 

**Tietokoneet**

[*Fyysinen kone: Lenovo Legion 7 16ACHg6*](https://nanoreview.net/en/laptop/lenovo-legion-7-2021-amd?m=c.1_g.3_r.3_s.3)

[*Vagrant: debian/testing64*](https://app.vagrantup.com/debian/boxes/testing64/versions/20240228.1)

[*Vagrant: debian/bullseye64*](https://app.vagrantup.com/debian/boxes/bullseye64/versions/11.20240212.1)

### Milloin?

Testit suoritettiin 28.3. - 30.3. v√§lill√§. Lopullinen muotoilu ja oikoluku tehtiin 31.3.

## L√§mmittelyteht√§v√§

### Salt-komentojen py√∂ritt√§minen paikallisesti

- Artikkeli esitt√§√§ esimerkkej√§ salt-call -komennoista, joita voi antaa paikallisesti esimerkiksi testatakseen niiden ominaisuuksia.
- Asennusohjeet saltiin
- Eri komentoja eri tilafunktioihin
  
### Web-sivujen tekeminen Githubilla

- Ohjeet mahdolliseen teht√§v√§npalautusmuotoon, joka toimii erinomaisesti portfoliona
- Ohjeet on artikkelissa uuden s√§ilytyspaikan tekemiseen.
- Artikkelissa on muotoiluohjeita.

### Raportin kirjoittaminen

- T√§rkeimp√§n√§ on kirjoittaa konkreettisesti sit√§, mit√§ tekee
- Helppolukuisuutta voi parantaa hy√∂dynt√§m√§ll√§ v√§liotsikoita, huolellista kielt√§ ja tiivist√§en ydinpointtia.
- Kaikista suurin virhe on valehdella tehneens√§ testej√§ plagioinnin ja tekij√§noikeuksien rikkomisten lis√§ksi.

## Saltin asentaminen Windowsiin

**K√§ytt√∂j√§rjestelm√§: Windows 11 Pro for Workstations 23H2**

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/465e03f7-a38d-48c9-947b-df161fdfb946)

Minulla oli salt valmiiksi asennettuna Windowsiin. T√§h√§n menness√§ olen ymm√§rt√§nyt, ett√§ voin antaa samoja komentoja powershelliin kuin tekisin tyypillisesti Tein kyseisen toimenpiteen ensimm√§isen luennon aikana. Haluan viel√§ selvitt√§√§, voiko saltin asentaa powershellin kautta. P√§√§dyin poistamaan saltin Windowsista.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/f68d8e8c-95e8-4887-9a96-e4eebe2a0a04)

T√§m√§n j√§lkeen kokeilin pelk√§st√§√§n powershell-komennolla asentaa Saltin Windowsiin. Oikeastaan v√§litt√∂m√§sti tajusin sen olevan ep√§k√§yt√§nn√∂llist√§, koska Windowsilla ei ole samanlaista pakettivarastoa kuin Linuxissa. L√∂ysin nopean googlauksen j√§lkeen [Salaudeen Rajackin artikkelin](https://www.sharepointdiary.com/2021/02/download-files-using-powershell.html), jossa n√§ytet√§√§n eri komentoja verkossa olevien tiedostojen lataukseen. Suoritin alla olevan komennon lataakseni Saltin asennustiedoston Windowsiin. 

`Invoke-WebRequest -Uri "https://repo.saltproject.io/salt/py3/windows/latest/Salt-Minion-3007.0-Py3-AMD64-Setup.exe" -OutFile "C:\Users\sakus\Downloads\saltohjelma.exe" -UseBasicParsing -PassThru`

Yritin aiemmin lis√§t√§ toisen komennon per√§√§n, joka lis√§isi edistymispalkin komentoon. En pystynyt siihen ilman scripti√§, ja ajattelin j√§tt√§√§ sen my√∂hemm√§lle. Ohjelma valittaa muuttujan puutteesta, ja en tied√§, miten lis√§t√§ muuttuja komentoon, joka ei hy√∂dynn√§ scripti√§. Yritin hy√∂dynt√§√§ artikkelin pohjaa. Oletin komennon toimivan, koska artikkelia oli p√§ivitetty noin 2 kuukautta sitten t√§t√§ teht√§v√§√§ tehdess√§.

`Invoke-WebRequest -Uri "https://repo.saltproject.io/salt/py3/windows/latest/Salt-Minion-3007.0-Py3-AMD64-Setup.exe" -OutFile "C:/Users/sakus/Downloads/saltohjelma.exe" -UseBasicParsing -PassThru | Write-Progress -Activity "Downloading file" -Status "Progress"`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e27dbc17-bb9a-4a93-a17d-811fa32df229)

Halusin hieman lis√§√§ hifistell√§, ja k√§ynnist√§√§ asennusohjelma Powershellin kautta. 

`& C:/Users/sakus/Downloads/saltohjelma.exe`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e8e881d1-28e1-4e1b-a933-a6a7d6d7b9dc)


T√§ss√§ vaiheessa annan installerin k√§ynnist√§√§ saltin itse.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/2615f08c-adf7-4af9-a523-1c3a7161decf)

Varmistin viel√§, onko Salt asennettu.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b074c447-0358-4579-b450-9d51d5600bc7)

T√§st√§ teht√§v√§st√§ opin sen, **kuinka hidasta on manuaalisesti suorittaa komentoja ilman scriptej√§**. Tulen toivottavasti opettelemaan scripteist√§ lis√§√§ tulevaisuudessa.

## Vagrantin asennuksen tarkistaminen Windowsissa

**K√§ytt√∂j√§rjestelm√§: Windows 11 Pro for Workstations 23H2**

Vagrantin asennuksen voi tarkistaa esimerkiksi seuraavalla komennolla: `vagrant version`
![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/cbb9ef46-8940-49db-8cd8-cd19a87b369d)

## Uuden virtuaalikoneen luominen Vagrantilla hy√∂dynt√§m√§ll√§ valmista virtuaalikonetta Vagrant Cloud -ymp√§rist√∂st√§

**K√§ytt√∂j√§rjestelm√§: Windows 11 Pro for Workstations 23H2**

Vagrantilla uuden virtuaalikoneen voi luoda yksinkertaisimmillaan katsomalla ensin Vagrant Cloudista haluttu virtuaalikone, mink√§ j√§lkeen hy√∂dynnet√§√§n `vagrant init ESIMERKKI/KONE` -komentoa. T√∂rm√§sin [FreeCodeCampin artikkeliin](https://www.freecodecamp.org/news/create-and-manage-virtual-machines-with-vagrant/), jossa annettiin muistutus siit√§, ett√§ pit√§√§ luoda oma kansio virtuaalikoneelle. Suoritin komennon kuin `mkdir "VagrantTestiH1" ; cd VagrantTestiH1`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/57173b32-4e5e-472b-b037-2e2cf73ccdb8)

Itse valitsin satunnaisesti [t√§m√§n kyseisen virtuaalikoneen](https://app.vagrantup.com/debian/boxes/testing64) k√§ytett√§v√§ksi. Voimme tietenkin v√§itell√§ siit√§, oliko valinta oikeasti t√§ysin sattumaa. Suoritin `vagrant init debian/testing64` -komennon. Ajattelin testauksen vuoksi l√§hte√§ pois kyseisest√§ kansiosta pois `cd ~` -komennolla kokeillakseni, voinko k√§ynnist√§√§ vagrant-tiedoston ollesani eri kansiossa kuin itse tiedosto. Heti tajusin `Vagrant global-status` -komennon tehty√§ni, ett√§ kyseinen toimenpide on viel√§ mahdoton. Mink√§√§n tietokoneen tietoja ei tullut Powershelliin, koska itse tietokonetta ei olla edes ladattu. Se toimisi vasta my√∂hemmin. Suoritin tyls√§sti komennon `vagrant up`, jotta voin jatkaa teht√§v√§ss√§ eteenp√§in.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/749beee4-9ce4-4b4f-a6bf-037e3defe193)

P.s Kokeilin v√§litt√∂m√§sti `vagrant halt KONEENID` -komentoa, ja sen j√§lkeen `vagrant up KONEENID`. Se taisi toimia! `Vagrant up`-komento on samaan aikaan kuin virtuaalikoneen asennus- ja p√§√§llekytkemisohjelma.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/82bc2f97-8db0-4916-a0a5-fb7f76983759)

## Saltin asennus Linuxiin ja ep√§onnistuneen asentamisen kartoittaminen

**K√§ytt√∂j√§rjestelm√§t: Windows 11 Pro for Workstations 23H2, Debian 13 "trixie" TESTAUSVERSIO, Debian 11 "bullseye"**

Muodostin ssh:lla yhteyden virtuaalikoneeseeni komennolla `vagrant ssh 7064575`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/38983468-d9a2-48d8-8e1f-5dd8d55db344)

Hy√∂dynt√§m√§ll√§ Tero Karvisen [Salt-komentojen py√∂ritt√§minen paikallisesti -artikkelia](https://terokarvinen.com/2021/salt-run-command-locally/) suoritin komentosarjan `sudo apt-get update & sudo apt-get -y install salt-minion && sudo salt-call --version`. Jostain syyst√§ salt-minionin lataaminen ei onnistunut, joten kokeilin `sudo apt-get upgrade`-komentoa, jonka j√§lkeen kokeilin uudestaan ladata minionin. Se ei toiminut taaskaan, koska kyseist√§ tiedostoa ei testing64 -debian pystynyt l√∂yt√§m√§√§n.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e6234297-432e-4eb4-a8d5-b1eb883705da)

Salt-masteri√§k√§√§n ei l√∂yt√§nyt.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bba77937-b8ee-4311-9d17-58738402af50)

Apache2:n kone l√∂ysi, mik√§ h√§mmenti minua suuresti. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/1e229e7f-48ec-4f05-8f85-e70e09f295ee)

Mietin t√§ss√§ vaiheessa, mik√§ aiheutti ongelman. Yritin ensin katsoa `help`-komennon kautta saatavilla olevia komentoja, mink√§ j√§lkeen kokeilin viel√§ `info`-komentoa. T√§m√§ komento ei ollut saatavilla, vaikka `help`-komento kannusti k√§ytt√§m√§√§n `info`-komentoa. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/df18702e-f0f8-43d8-a44b-c9403f399fe0)

Vasta t√§ss√§ vaiheessa tajusin ottaa selv√§√§ erikseen Googlella, mitk√§ ovat j√§rjestelm√§- ja k√§ytt√∂j√§rjestelm√§infokomennot. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/6191daf1-4fde-4ccb-964a-45dda71226c0)

Tuli hieman tyhm√§ olo j√§lkeenp√§in, koska olin k√§ytt√§nyt Debianin ep√§vakaata "trixie" -julkaisua, josta ei ole viel√§k√§√§n julkistettu mink√§√§nlaista mahdollista julkaisuajankohtaa. Ryhdyin heti vaihtamaan virtuaalikonetta, ja olen luonut jo aiemmin kansion sit√§ varten. Halusin vaihtaa [debian/bullseye64 -versioon](https://app.vagrantup.com/debian/boxes/bullseye64), koska tiesin sen aiemman kokemuksen perusteella olevan vakaa, ja jossa toimii salt. Varmistin ensin vanhan virtuaalikoneen olevan poistettu, ja sen j√§lkeen py√∂ritin komennon `vagrant init debian/bullseye64 --force ; vagrant up`. Force-asetus oli ehk√§ mielest√§ni turha, mutta sen toteutin ollakseni 100% varma, ett√§ se toimii.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/818348db-8a3a-4046-a6ef-b9f6cadb23e9)


Nyt palasin takaisin siihen vaiheeseen, jossa minun on alunperin pit√§nyt olla. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bac193e9-c795-4bfa-b0a0-79d0d2550bac)

Suoritin my√∂s komennon `sudo salt-call --version` uudelleen.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/640550d8-0024-4c11-8a92-35088477097c)

Teht√§v√§nanto venyi yll√§tt√§v√§n pitk√§ksi, mutta kokemus oli opettava!

## Tilafunktiot

<details>

<summary>pkg</summary>

### pkg

PKG -tilafunktiolla hallinoidaan valmisohjelmistojen toimintaa. Esimerkiksi voimme kokeilla saltilla Apache2:n asentamista. Suoritetaan komento `sudo salt-call --local -l info state.single pkg.installed apache2`.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/dce0653f-3526-4d3c-9f52-eb9aa54271c1)

K√§vi yksinkertaisesti huono tuuri asentamisen n√§k√∂kulmasta, koska asennustiedosto linkin takana ei ollut voimassa. Tiedosto on voimassa t√§t√§ raporttia kirjoittaessani vasta huomenna.Py√∂ritin viel√§ erikseen `which apache2`- ja `whereis apache2` -komennot ollakseni t√§ysin varma Apache2 -palvelun tiedostojen puuttumisesta.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/0f0f6a64-0252-4eb7-84c3-80e992dd335b)

Jostain kumman syyst√§ Apache2 on asennettavissa tyypillisen `sudo apt-get install` -komennon kautta. T√§m√§n j√§lkeen pohdin, voiko vika johtua yksinkertaisesta v√§√§r√§st√§ URL-osoitteesta, jota salt k√§ytt√§√§. L√§hdin selvitt√§m√§√§n syyn suorittamalla `sudo apt policy apache2` -komennon. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/ac8c07f6-d836-4bbc-80c0-24ba2bf6da81)

Komentojen tulosteen perusteella salt pyrkii saamaan kaikista uusimman version, mutta kyseinen versio ei ole viel√§ voimassa. Debian saa tiedostonsa virallisen julkaisun hakemiston kautta. Saltilla voi hallinnoida ohjelmistoarkistoon liittyvi√§ asioita pkgrepo -tilafunktiolla, johon en perehdy lis√§√§ toistaiseksi. Debian 12.5 julkistettiin 10.2.2024 [t√§ss√§ Debianin julkaisemassa uutisartikkelissa](https://www.debian.org/News/2024/20240210).  [Hakemistoon, josta onnistuu valmisohjelmisto Apache2:n lataaminen](https://ftp.debian.org/debian/dists/bullseye/), tehtiin viimeeksi muokkauksia samana p√§iv√§m√§√§r√§n√§. T√§m√§n tiedon perusteella seuraavana p√§iv√§n√§ t√§t√§ raporttia tehdess√§ni tulee Debian-p√§ivityksi√§ (jee!!).

Valitaan toinen ohjelmisto ladattavaksi. Mik√§ olisi parempi ohjelmisto lataa Linux-k√§ytt√∂j√§rjestelm√§lle kuin [Cowsay](https://github.com/tnalpgge/rank-amateur-cowsay)? Suoritin komennon `sudo salt-call --local -l info state.single pkg.installed cowsay`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/e9632f45-5c34-4e51-aac7-19d8b19ac7a3)

T√§m√§n perusteella olin jo asentanut Cowsayn t√§lle kyseiselle virtuaalikoneelle. Kirjoitin seuraavaksi komennon `sudo salt-call --local -l info state.single pkg.removed cowsay`. Hyv√§sti Cowsay :(

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/c8215841-a8bf-40d4-921c-5d2fa2c4b3a7)

Tulosteen perusteella poistaminen onnistui t√§ysin. Haluan silti varmistaa, onko kyseinen ohjelmisto poistettu kokonaan hy√∂dynt√§m√§ll√§ `which`- ja `whereis`-komentoja. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b03ff6d7-462d-445b-819e-67fb9c01e332)

</details>


<details>

<summary>file</summary>

### file

File-tilafunktiolla hallinnoidaan tietokoneen tiedostoja ja hakemistoja. Lis√§√§n hakemiston kuin "Cowsayn-Hautajaiset-30-03-2024" komennolla `sudo salt-call --local -l info state.single file.directory ~/Cowsayn-Hautajaiset-30-03-2024`. Lis√§t√§√§n viel√§ tiedostoja, jotka liittyv√§t hautajaisiin, hakemiston sis√§lle. Hy√∂dynt√§m√§ll√§ `sudo salt-call --local -l info state.single file.managed ~/Cowsayn-Hautajaiset-30-03-2024/TIEDOSTON-ESIMERKKINIMI`-komentoa pohjana.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/1c270fb0-b985-48de-8921-d9f087ea6fa9)


![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/750ef54b-f750-41c5-bd38-0a76bbe6ad58)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/f08dce7e-ec9a-4726-8790-71e3d16b96bb)


![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/015f2da7-d71f-4139-8240-3e79ab8855b6)

Muuten tulosteena n√§ytet√§√§n tismalleen samanlaista informaatiota kuin PKG-funktion toteutuessa, mutta merkitt√§vin ero on kommentissa. Kommentti spesifoi, mit√§ tiedoston sis√§ll√§ on. Lis√§t√§√§n hautajaislistaan nimi√§ seuraavalla komennolla. `sudo salt-call --local -l info state.single file.managed ~/Cowsayn-Hautajaiset-30-03-2024/Hautajaisvieraat contents="Saku Laitinen"`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/a54273e9-7939-415d-be50-879accf597dd)

</details>

<details>

<summary>service</summary>

### service

Service-tilafunktiolla hallinoidaan, jotka ovat k√§yt√§nn√∂ss√§ taustalla olevii automatisoituja prosesseja, kuten esimerkiksi Samban taustaprosesseja. Samba on suosituin Windows-yhteensopivuusohjelma Linux ja Unix j√§rjestelmiin. Otetaan kyseinen palvelu mukaan t√§h√§n esimerkkiin. Suoritan komennon `sudo salt-call --local -l info state.single service.running smbd enable=True` ja sen j√§lkeen `systemctl` tarkastaakseni lopputuloksen


![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bc55bccc-c7aa-469f-a9f4-c1912018d7e2)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/3e7cda6d-5823-4362-997a-1ee018d8dc92)


Palvelu on jo k√§yt√∂ss√§, mutta voimme kokeilla sen sammuttamista kokonaan komennolla `sudo salt-call --local -l info state.single service.dead smbd enable=False`

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/15d785f2-02ee-496e-b83d-f2f971c761c4)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/06c69b48-ec95-4b74-bb38-091be1fcb76d)

Haluaisin ihan huvikseen kokeilla, mit√§ tapahtuisi seuraavissa tilanteissa: `service.dead smbd enable=True` ja `service.running smbd enable=False`

***running & False***

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/b4e768d6-b2b7-486b-9c4f-a08fc596e65a)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/611f03c4-515a-44e2-998d-f3b860958c7e)

***dead & True***

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/bedea40f-09bd-4a21-93d7-6a46d61496e8)

T√§ss√§ vaiheessa lis√§√§n alkuper√§isen komennon per√§√§n `--all`-asetuksen, ett√§ n√§en varmasti kaikki palvelut.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/a368a630-f5ec-42e4-8b9e-7830d4ef751b)

Sammutin virtuaalikoneen `vagrant halt`-komennolla ja k√§ynnistin sen uudestaan `vagrant up`-komennolla. Yhdistin takaisin ssh:lla `vagrant ssh 6df82ef` -komennolla. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/f45a1b34-450b-42aa-af9d-4b479efade6c)

**Tajusin yhden kriittisen asian vasta nyt: Minun ei tarvitse komentaa Linuxia tulostamaan _kaikkien_ palveluiden tilaa.** Voin yksinkertaisesti valita haluamani palvelun esim. smbd:n komennolla `systemctl status smbd`. ü§¶ Ratkaisun yksinkertaisuus, helppous ja mukavuus on jotenkin aivan k√§sitt√§m√§t√∂nt√§ minulle!

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/afd63d75-5dca-4e20-9511-3b0d056eed1e)

Vahvistin itselleni, ett√§ enable-funktio m√§√§ritt√§√§ saltissa, k√§ynnistyyk√∂ palvelu boottausprosessin aikana vai ei.

</details>

<details>

<summary>user</summary>

### user

User-tilafunktion tarkoitus on hallita k√§ytt√§j√§asetuksia. K√§yt√§nn√∂ss√§ se tarkoittaa k√§ytt√§jien lis√§√§mist√§, poistamista, nime√§mist√§ ja ryhm√§n m√§√§rityst√§. Seuraavaksi n√§yt√§n esimerkkej√§ `user.present` -ja `user.absent` -komennoista.

Ensin toteutan komennon `sudo salt-call --local -l info state.single user.present bossbeibi24
 `, joka luo k√§ytt√§j√§n "bossbeibi24" koneelleni. 

 ![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/5b200c5d-670f-4fab-b819-af7041504149)

Tulos n√§ytt√§√§ tarkan kuvauksen k√§ytt√§j√§n tiedoista, ja mitk√§ tiedot puuttuvat. 

Seuraavaksi poistetaan k√§ytt√§j√§ ja varmistetaan kaikkien tiedostojen poisto komennolla `sudo salt-call --local -l info state.single user.absent bossbeibi24 purge=True `

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/a889c35b-0e91-4364-b676-4b0dd0df2e05)

Tuntuipa brutaalilta puhdistaa vauva, koska valitettavasti kyse ei ollut puhdistamisesta vaan puhdistuksesta. ü§£

</details>

<details>

<summary>cmd</summary>

### cmd

Tilafunktio cmd:n teht√§v√§ on py√∂ritt√§√§ komento. Kyseist√§ funktiota k√§ytet√§√§n k√§yt√§nn√∂ss√§ ainoastaan .sls-tiedostoissa YAML-merkkauskielen seassa. Se on t√§ysin turha funktio n√§pp√§ill√§ komentokehotteeseen ellei halua huvikseen testata ep√§imdempotenttia funktiota idempotenttissa ymp√§rist√∂ss√§. Siit√§ ei tule mit√§√§n. Voin konkreettisesti n√§ytt√§√§, mit√§ tapahtuu, jos komennolla pyrin lis√§√§m√§√§n t√§ysin identtisen tiedoston samaan sijaintiin. Varmistan viel√§ komennolla `sudo salt-call --local -l info state.single file.managed ~/Cowsayn-Hautajaiset-30-03-2024/Hautajaisvieraat`, onko tiedosto olemassa en√§√§.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/7d33b6b2-a6ca-443e-95bd-3b09ba403016)

T√§m√§n j√§lkeen n√§yt√§n, mit√§ tapahtuu, jos yrit√§n rikkoa idempotenssin lakia idempotentissa ymp√§rist√∂ss√§ komennolla `sudo salt-call --local -l info state.single cmd.run 'sudo touch /home/vagrant/Cowsayn-Hautajaiset-30-03-2024/Hautajaisvieraat'`. 

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/3b7472e8-e7c1-4138-aa7d-b76844c102aa)

Tulokset voivat h√§m√§t√§, koska kyseinen tilafunktio toteutti teht√§v√§ns√§, ja pisti kyseisen komennon py√∂rim√§√§n j√§rjestelm√§√§n. Tilafunktio cmd:n teht√§v√§n√§ on ainoastaan survoa komento suoritettavaksi komentoriville riippumatta komennon aiheuttamasta lopputuloksesta. Ainoa taho, jota cmd-tilafunktio tottelee on bash. Jos Bash ei pysty l√∂yt√§m√§√§n kyseist√§ komentoa tietokoneesta, silloin ainoastaan tulee failed -viesti n√§yt√∂lle.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/45ce6453-bf61-4737-a528-6e726c38a644)

</details>


## Idempotenssi ja sen konkreettiset esimerkit

Idempotenssi tarkoittaa yksinkertaistettuna saman tuloksen saamista riippumatta siit√§, onko lopputulokseen teht√§v√§ prosessi suoritettu yhden tai useamman kerran. T√§m√§n teht√§v√§n kontekstin n√§k√∂kulmasta kyseiset salt-komennot muokkaavat tietokonetta ja sen sis√§lt√∂√§ ainoastaan, jos toimenpide on tarpeellinen halutun lopputuloksen saavuttamiseksi.

$f\left(x\right)=f\left(f\left(x\right)\right)$

Esimerkiksi, jos haluan lis√§t√§ hakemiston ‚ÄúEeppiset animetappelut‚Äù nykyisen k√§ytt√§j√§n kotihakemistoon,  ja m√§√§ritelty hakemisto puuttuu, file.directory -tilafunktio lis√§√§ kyseisen hakemiston kotihakemistoon.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/2746ffc7-18aa-40dd-ba5d-98a0a31a111a)


Jos komennon suorittaa uudelleen, uutta ‚ÄúEeppiset animetappelut‚Äù -hakemistoa ei lis√§t√§ kotihakemistoon. Jos halutaan lis√§t√§ uusi hakemisto, on muokattava alkuper√§ist√§ komentoa. Uuden komennon tarvittavat muutokset on lis√§tt√§v√§n kansion uusi sijainti tai nimi. Eli joko yksi kahdesta tai molemmat ehdoista voivat toteutua.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/265221a2-4d64-4767-800e-5fdb31b44400)


***Uusi nimi***

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/5b4000d1-5d0d-4975-b1c2-39d393ff154f)

***Uusi kansio***

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/77e74a0e-0fb6-4545-884a-e498ae55051e)

p.s Jos haluatte matemaattisia kaavoja helposti githubiin, k√§ytt√§k√§√§ [YTL:n matikkaeditoria](https://math-demo.abitti.fi/) ‚ú®‚òùÔ∏è

## Grains

Suoritan komennon `sudo salt-call --local grains.items'; 'sudo salt-call --local grains.item osfinger virtual`, jota on [Tero Karvisen teht√§v√§nannossa](https://terokarvinen.com/2024/configuration-management-2024-spring/) ohjeistettu k√§ytt√§m√§√§n. Kyseineen funktio tulostaa komentokehotteeseen j√§rjestelm√§tiedot.

Ehdottomasti kaikista kiinnostavimmat yksityiskohdat oli CPU flagit, muistin v√§h√§inen 472 mt:n m√§√§r√§ ja
python-ohjelmointikielen vahva l√§sn√§olo.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/98b1be34-5511-49a2-8a1e-738457280986)

N√§it√§ flageja on ehdottomasti paljon enemm√§n, mit√§ kuvasssa n√§kyy. Valitsin muutaman flagin selitett√§v√§ksi yhdell√§ lauseella. CX8-lippu antaa ohjeita muistin hallinnoimiseen vertaamisen ja vaihtamisen n√§k√∂kulmasta. 
![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/674dab28-41ef-457f-89d0-c02985e88657)

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/60730691-4835-49ba-96d8-c2aa93af7fbc)

En olisi yll√§ttynyt, jos salt lukee muistia eri tavalla kuin bash-komento. Sama tilanne on Windows-k√§ytt√∂j√§rjestelmiss√§, kun kovalevyll√§ n√§ytt√§isi olevan v√§hemm√§n tallennustilaa verrattuna siihen, mit√§ itse kovalevyss√§ lukee tallennustilan suhteen.

![image](https://github.com/KebabGarva/Linux-palvelinten-hallinta-bgu248/assets/89390996/abff9c46-2b9a-4ff6-97d9-1e5308c4c4a2)


Kiinnitin huomiota siihen, ett√§ saltiin liittyv√§t tiedot on Pythonia k√§yt√§nn√∂ss√§. Koko Salt taitaa olla Pythonia. Olen henkil√∂kohtaisesti sellaisessa tilanteessa el√§m√§ss√§ni, ja on saatava Python kerrattua siihen malliin, ett√§ voin kertoa hyv√§ll√§ omatunnolla cv:ss√§ ja portfoliossa minun osaavan Pythonia tarpeeksi hyvin. Kaikki liittyen tietokoneisiin on kuitenkin yksinkertaisimmillaan ykk√∂si√§ ja nollia, joita k√§sket√§√§n koodeilla tekem√§√§n jotain mielenkiintoista.

## L√§hteet

https://www.sharepointdiary.com/2021/02/download-files-using-powershell.html
https://www.freecodecamp.org/news/create-and-manage-virtual-machines-with-vagrant/
https://terokarvinen.com/2021/salt-run-command-locally/
https://en.wikipedia.org/wiki/CPUID#EAX=1:_Processor_Info_and_Feature_Bits

